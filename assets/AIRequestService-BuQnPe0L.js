import{r as n,j as e,c as L}from"./index-ykkmzoko.js";const H=({image:o,onImageUpload:i})=>{const[s,c]=n.useState(!1),[r,x]=n.useState(),p=t=>{const a=t.target;if(a.files&&a.files[0]){const l=a.files[0],h=new FileReader;h.onload=M=>{const g=new Image;g.src=M.target.result,g.onload=()=>{const w=document.createElement("canvas"),P=w.getContext("2d"),f=400,T=g.height/g.width,S=f*T;w.width=f,w.height=S,P.drawImage(g,0,0,f,S);const E=w.toDataURL("image/jpeg",.8);x(E),i(o,E)}},h.readAsDataURL(l)}},[d,R]=n.useState(!1),u=n.useRef(null),C=n.useRef(null),[v,D]=n.useState(!1),[j,k]=n.useState(null),[_,I]=n.useState([]),[m,b]=n.useState(null);n.useEffect(()=>{(async()=>{const l=(await navigator.mediaDevices.enumerateDevices()).filter(h=>h.kind==="videoinput");I(l),l.length>0&&b(l[0].deviceId)})()},[]);const N=async()=>{try{const t={video:{deviceId:m?{exact:m}:void 0}},a=await navigator.mediaDevices.getUserMedia(t);u.current.srcObject=a,u.current.play(),k(a)}catch(t){console.error("Error accessing the camera:",t)}},y=()=>{j&&(j.getTracks().forEach(t=>t.stop()),k(null))},V=()=>{const t=u.current,a=C.current;if(!a){console.error("Canvas element is not available.");return}const l=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,l.drawImage(t,0,0,a.width,a.height);const h=a.toDataURL("image/jpeg");x(h),D(!0),i(o,h),y()};return n.useEffect(()=>(d&&N(),()=>{y()}),[d,m]),e.jsxs("div",{className:"bg-second dark:bg-second-dark p-2 sm:p-4 w-full sm:w-fit flex flex-col gap-2",children:[e.jsx("div",{className:"w-full sm:w-[400px] h-[500px] bg-black dark:bg-white",children:s?e.jsx("img",{src:r,alt:"Uploaded PCB",className:""}):e.jsx("div",{className:"bg-black dark:bg-white w-full h-full",children:d&&e.jsxs("div",{children:[e.jsx("video",{ref:u,style:{width:"100%",maxWidth:"500px",display:v?"none":"block"}}),e.jsx("canvas",{ref:C,style:{display:"none",width:"100%",maxWidth:"500px"}}),v&&e.jsx("div",{children:e.jsx("img",{src:r,alt:"Captured",style:{width:"100%",maxWidth:"500px"}})})]})})}),e.jsxs("div",{className:`flex items-center  ${d?"justify-center":"justify-between"}`,children:[!s&&!d&&e.jsx("div",{onClick:()=>R(!0),className:`relative p-3 bg-second dark:bg-second-dark rounded-full scale-[.8] sm:scale-100 ${d?"hidden":"visible"}`,children:e.jsxs("svg",{fill:"#000000",width:"40px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74.207 74.207",xmlSpace:"preserve",children:[e.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),e.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",e.jsxs("g",{children:[" ",e.jsx("path",{d:"M57.746,14.658h-2.757l-1.021-3.363c-0.965-3.178-3.844-5.313-7.164-5.313H28.801c-3.321,0-6.201,2.135-7.165,5.313 l-1.021,3.363h-4.153C7.385,14.658,0,22.043,0,31.121v20.642c0,9.077,7.385,16.462,16.462,16.462h41.283 c9.077,0,16.462-7.385,16.462-16.462V31.121C74.208,22.043,66.823,14.658,57.746,14.658z M68.208,51.762 c0,5.769-4.693,10.462-10.462,10.462H16.462C10.693,62.223,6,57.53,6,51.762V31.121c0-5.769,4.693-10.462,10.462-10.462h8.603 l2.313-7.621c0.192-0.631,0.764-1.055,1.423-1.055h18.003c0.659,0,1.23,0.424,1.423,1.057l2.314,7.619h7.204 c5.769,0,10.462,4.693,10.462,10.462L68.208,51.762L68.208,51.762z"})," ",e.jsx("path",{d:"M37.228,25.406c-8.844,0-16.04,7.195-16.04,16.04c0,8.844,7.195,16.039,16.04,16.039s16.041-7.195,16.041-16.039 C53.269,32.601,46.073,25.406,37.228,25.406z M37.228,51.486c-5.536,0-10.04-4.504-10.04-10.039c0-5.536,4.504-10.04,10.04-10.04 c5.537,0,10.041,4.504,10.041,10.04C47.269,46.982,42.765,51.486,37.228,51.486z"})," "]})," "]})]})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:V,className:"relative p-3 bg-second dark:bg-second-dark rounded-full scale-[.8] sm:scale-100",children:e.jsxs("svg",{fill:"#000000",width:"40px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74.207 74.207",xmlSpace:"preserve",children:[e.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),e.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",e.jsxs("g",{children:[" ",e.jsx("path",{d:"M57.746,14.658h-2.757l-1.021-3.363c-0.965-3.178-3.844-5.313-7.164-5.313H28.801c-3.321,0-6.201,2.135-7.165,5.313 l-1.021,3.363h-4.153C7.385,14.658,0,22.043,0,31.121v20.642c0,9.077,7.385,16.462,16.462,16.462h41.283 c9.077,0,16.462-7.385,16.462-16.462V31.121C74.208,22.043,66.823,14.658,57.746,14.658z M68.208,51.762 c0,5.769-4.693,10.462-10.462,10.462H16.462C10.693,62.223,6,57.53,6,51.762V31.121c0-5.769,4.693-10.462,10.462-10.462h8.603 l2.313-7.621c0.192-0.631,0.764-1.055,1.423-1.055h18.003c0.659,0,1.23,0.424,1.423,1.057l2.314,7.619h7.204 c5.769,0,10.462,4.693,10.462,10.462L68.208,51.762L68.208,51.762z"})," ",e.jsx("path",{d:"M37.228,25.406c-8.844,0-16.04,7.195-16.04,16.04c0,8.844,7.195,16.039,16.04,16.039s16.041-7.195,16.041-16.039 C53.269,32.601,46.073,25.406,37.228,25.406z M37.228,51.486c-5.536,0-10.04-4.504-10.04-10.039c0-5.536,4.504-10.04,10.04-10.04 c5.537,0,10.041,4.504,10.041,10.04C47.269,46.982,42.765,51.486,37.228,51.486z"})," "]})," "]})]})}),e.jsx("select",{value:m,onChange:t=>b(t.target.value),className:"ml-2 p-2 bg-second dark:bg-second-dark text-black text-[12px] dark:text-black rounded",children:_.map(t=>e.jsx("option",{value:t.deviceId,children:t.label||`Camera ${t.deviceId}`},t.deviceId))})]}),!d&&e.jsxs("div",{className:"relative p-3 bg-second dark:bg-second-dark rounded-full scale-[.8] sm:scale-100",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",width:"40px",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),e.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",e.jsx("path",{d:"M12 15L12 2M12 2L15 5.5M12 2L9 5.5",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})," ",e.jsx("path",{d:"M8 22.0002H16C18.8284 22.0002 20.2426 22.0002 21.1213 21.1215C22 20.2429 22 18.8286 22 16.0002V15.0002C22 12.1718 22 10.7576 21.1213 9.8789C20.3529 9.11051 19.175 9.01406 17 9.00195M7 9.00195C4.82497 9.01406 3.64706 9.11051 2.87868 9.87889C2 10.7576 2 12.1718 2 15.0002L2 16.0002C2 18.8286 2 20.2429 2.87868 21.1215C3.17848 21.4213 3.54062 21.6188 4 21.749",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round"})," "]})]}),e.jsx("input",{type:"file",accept:"image/*",name:o,onClick:()=>c(!0),onChange:p,className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"})]})]})]})},U=async(o,i)=>{try{const s=await W(o);return i(c=>({...c,Defects:s})),s}catch(s){throw console.error("Error:",s),alert("Failed to get response from API."),s}},O=async(o,i)=>{try{const s=await G(o);return i(c=>({...c,Components:s})),s}catch(s){throw console.error("Error:",s),alert("Failed to get response from API."),s}},W=async o=>{const s={image:o.split(",")[1]},c=L.DETECT_DEFECTS_URL();try{const r=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const p=await r.json();throw console.error("Error response:",p),new Error("Network response was not ok")}return await r.json()}catch(r){throw alert("Error:",r),r}},G=async o=>{const s={image:o.split(",")[1]},c=L.DETECT_COMPONENTS_URL();try{const r=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const p=await r.json();throw console.error("Error response:",p),new Error("Network response was not ok")}return await r.json()}catch(r){throw console.error("Error:",r),r}};export{H as A,O as a,U as h};
